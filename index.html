
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>ĞŸÑƒĞ»ÑŒÑ-Ğ¾Ğ¿Ñ€Ğ¾Ñ â€” ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin:0;padding:0;background:#f3f3f3;font-family:'Segoe UI',sans-serif;">

<div id="mood-widget" style="padding: 20px; border-radius: 16px; max-width: 350px; text-align: center; margin: 0 auto;">
  <h3 style="margin: 0 0 10px;">ĞšĞ°Ğº Ñ‚Ñ‹ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ? ğŸ¤”</h3>
  <div id="mood-options" style="font-size: 24px;">
    <span class="mood" data-value="1">ğŸ˜</span>
    <span class="mood" data-value="2">ğŸ˜•</span>
    <span class="mood" data-value="3">ğŸ˜</span>
    <span class="mood" data-value="4">ğŸ™‚</span>
    <span class="mood" data-value="5">ğŸ˜„</span>
  </div>
  <div id="mood-result" style="margin-top: 10px; font-size: 14px; color: #666; display: none;">Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾ Ğ·Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‚!</div>
  <div id="mood-average" style="margin-top: 10px; font-size: 16px; font-weight: bold; display: none;">Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ: ğŸ˜</div>
</div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbwSlDou6RFijtV-_1ekXYeYqjOOTlqDPl-QDjsXqtMHWzQPkD763AKgwlAXPKqeq2QQbA/exec";
  const emojiMap = {
    1: 'ğŸ˜',
    2: 'ğŸ˜•',
    3: 'ğŸ˜',
    4: 'ğŸ™‚',
    5: 'ğŸ˜„'
  };

  const moodKey = 'mood_vote';
  const dateKey = 'mood_vote_date';
  const today = new Date().toISOString().split('T')[0];

  const vote = localStorage.getItem(moodKey);
  const voteDate = localStorage.getItem(dateKey);

  const moodOptions = document.getElementById('mood-options');
  const moodResult = document.getElementById('mood-result');
  const moodAverage = document.getElementById('mood-average');

  function displayAverage() {
    fetch(API_URL)
      .then(res => res.json())
      .then(data => {
        const mood = Math.round(data.avg);
        moodAverage.innerText = `Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ: ${emojiMap[mood] || 'ğŸ˜'}`;
        moodAverage.style.display = 'block';
      });
  }

  if (vote && voteDate === today) {
    moodOptions.style.display = 'none';
    moodResult.innerText = `Ğ’Ñ‹ ÑƒĞ¶Ğµ Ğ¾Ñ‚Ğ¼ĞµÑ‚Ğ¸Ğ»Ğ¸ÑÑŒ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ ğŸ˜Š`;
    moodResult.style.display = 'block';
    displayAverage();
  }

  document.querySelectorAll('.mood').forEach(el => {
    el.addEventListener('click', function () {
      const value = this.getAttribute('data-value');
      const userName = window.userName || 'ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼';

      localStorage.setItem(moodKey, value);
      localStorage.setItem(dateKey, today);

      moodOptions.style.display = 'none';
      moodResult.innerText = 'Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾ Ğ·Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‚! ğŸ˜Š';
      moodResult.style.display = 'block';

      fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({
          name: userName,
          mood: Number(value)
        })
      });

      displayAverage();
    });
  });
</script>

</body>
</html>
